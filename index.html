<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <title>MetalBender</title>

    <!--Leaflet CDN-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css"
        integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"
        integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg=" crossorigin=""></script>
    <script type="text/javascript" src="dist/leaflet.ajax.js"></script>
    <!--JQuery CDN-->
    <script src="https://code.jquery.com/jquery-3.6.1.js"
        integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
    <!--Leaflet.markercluster CDN -->
    <link rel="stylesheet" href="../dist/MarkerCluster.css" />
    <link rel="stylesheet" href="../dist/MarkerCluster.Default.css" />
    <script src="../dist/leaflet.markercluster-src.js"></script>
    <!--Leaflet.Control.Search-->
    <link rel="stylesheet" href="dist/leaflet-search.min.css" />
    <script src="dist/leaflet-search.min.js"></script>
    <!-- My own external CSS for various parts -->
    <link rel="stylesheet" href="/main.css">
    <!-- font-awesome for zoom/home button -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" />
    <!-- Leaflet.Zoomhome -->
    <link rel="stylesheet" href="/dist/leaflet.zoomhome.css" />
    <script src="/dist/leaflet.zoomhome.min.js"></script>
    <!-- OSM search CDN-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <!-- Leaflet.Sidepanel -->
    <link rel="stylesheet" href="/dist/leaflet-sidepanel.css" />
    <script src="./dist/leaflet-sidepanel.min.js"></script>
    <!-- Bookmarks -->
    <script src="/dist/L.Control.Bookmarks.min.js"></script>
    <link type="text/css" rel="stylesheet" href="/dist/leaflet.bookmarks.css">

</head>

<body>
    <header class="header">
        <h1 style="display: inline-block">Metal Bender </h1>
        <h5 style="display: inline-block">Hold on to your toup√©e!</h5>
    </header>
    <!-- Map ID -->
    <div id="map">
        <!-- Side Panel right -->
        <div id="mySidepanelRight" class="sidepanel" aria-label="side panel" aria-hidden="false">
            <div class="sidepanel-inner-wrapper">
                <nav class="sidepanel-tabs-wrapper" aria-label="sidepanel tab navigation">
                    <ul class="sidepanel-tabs">
                        <li class="sidepanel-tab">
                            <a href="#" class="sidebar-tab-link" role="tab" data-tab-link="tab-1">
                                Info
                            </a>
                        </li>
                        <li class="sidepanel-tab">
                            <a href="#" class="sidebar-tab-link" role="tab" data-tab-link="tab-2">
                                Legend
                            </a>
                        </li>
                        <li class="sidepanel-tab">
                            <a href="#" class="sidebar-tab-link" role="tab" data-tab-link="tab-3">
                                Pin
                            </a>
                        </li>
                        <li class="sidepanel-tab">
                            <a href="#" class="sidebar-tab-link" role="tab" data-tab-link="tab-4">
                                Bookmarks
                            </a>
                        </li>
                        <li class="sidepanel-tab">
                            <a href="#" class="sidebar-tab-link" role="tab" data-tab-link="tab-5">
                                Suggest
                            </a>
                        </li>
                    </ul>
                </nav>
                <div class="sidepanel-content-wrapper">
                    <div class="sidepanel-content">
                        <div class="sidepanel-tab-content" data-tab-content="tab-1">
                            <h4 id="popuptitle"></h4>
                            <table style="width:100%;">
                                <tr>
                                    <td id="pic1" ;></td>
                                </tr>
                            </table><b></b>
                            <table style="width:100%;">
                                <tr>
                                    <th align="left">Address: </th>
                                </tr>
                                <tr>
                                    <td id="f1"></td>
                                </tr>
                                <tr>
                                    <th align="left">Description: </th>
                                </tr>
                                <tr>
                                    <td id="f3"></td>
                                </tr>
                            </table>
                        </div>
                        <div class="sidepanel-tab-content" data-tab-content="tab-2">
                            <!-- Legend -->
                            <div>
                                <img src="images/festival.png" style="vertical-align: middle;" width="70px" />
                                <span style="vertical-align: middle;">Festival</span>
                            </div>
                            <div>
                                <img src="images/pub.png" style="vertical-align: middle;" width="70px" />
                                <span style="vertical-align: middle;">Pub</span>
                            </div>
                            <div>
                                <img src="images/pubandrestaurant.png" style="vertical-align: middle;" width="70px" />
                                <span style="vertical-align: middle;">Pub & Restaurant</span>
                            </div>
                            <div>
                                <img src="images/pubandvenue.png" style="vertical-align: middle;" width="70px" />
                                <span style="vertical-align: middle;">Pub & Venue</span>
                            </div>
                            <div>
                                <img src="images/restaurant.png" style="vertical-align: middle;" width="70px" />
                                <span style="vertical-align: middle;">Restaurant</span>
                            </div>
                            <div>
                                <img src="images/recordstore.png" style="vertical-align: middle;" width="70px" />
                                <span style="vertical-align: middle;">Record Store</span>
                            </div>
                            <div>
                                <img src="images/venue.png" style="vertical-align: middle;" width="70px" />
                                <span style="vertical-align: middle;">Venue</span>
                            </div>
                        </div>
                        <div class="sidepanel-tab-content" data-tab-content="tab-3">
                            <h4>Coming soon...</h4>
                            <p>Nothing to see here.</p>
                        </div>
                        <div class="sidepanel-tab-content" data-tab-content="tab-4">
                            <h4>Coming soon...</h4>
                            <p>Nothing to see here.</p>
                        </div>
                        <div class="sidepanel-tab-content" data-tab-content="tab-5">
                            <h4>Suggest a location! </h4>
                            <h6>
                                <font color="grey">TYPE, NAME and ADDRESS required.</font>
                            </h6>
                            <div class="container">
                                <form action="/action_page.php">
                                    <label for="country">TYPE</label>
                                    <select id="locationtype" name="Location Type">
                                        <option value="Festival">Festival</option>
                                        <option value="Pub">Pub</option>
                                        <option value="Pub & Restaurant">Pub & Restaurant</option>
                                        <option value="Pub & Venue">Pub & Venue</option>
                                        <option value="Restaurant">Restaurant</option>
                                        <option value="Record/Clothing Store">Record Store</option>
                                        <option value="Venue">Venue</option>
                                        <option value="Other">Other...</option>
                                    </select>
                                    <label for="name">NAME</label>
                                    <input type="text" id="name" name="name" placeholder="...of location">
                                    <label for="addy">ADDRESS</label>
                                    <input type="text" id="addy" name="address" placeholder="...of location">
                                    <label for="country">COUNTRY</label>
                                    <input type="text" id="country" name="country" placeholder="...of location">
                                    <label for="hours">HOURS</label>
                                    <input type="text" id="hours" name="hours" placeholder="...operating hours">
                                    <label for="website">WEBSITE</label>
                                    <input type="text" id="website" name="website" placeholder="...if there is one">
                                    <label for="subject">DESCRIPTION</label>
                                    <textarea id="description" name="subject"
                                        placeholder="your description will added once reviewed..."
                                        style="height:200px"></textarea>
                                    <input type="submit" value="Submit">
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidepanel-toggle-container">
                <button class="sidepanel-toggle-button" type="button" aria-label="toggle side panel"></button>
            </div>
        </div>
    </div>
    <!-- Scripts -->
    <script>
        // initialize the map. create OSM basemap
        var map = L.map('map', { zoomControl: false }).setView([37.52715, -9.877441], 1.5);

        var osm = new L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var zoomHome = L.Control.zoomHome({ position: 'bottomleft' });
        zoomHome.addTo(map);

        // Sidepanel
        const sidepanelRight = L.control.sidepanel('mySidepanelRight', {
            panelPosition: 'right',
            tabsPosition: 'top',
            pushControls: true,
            darkMode: true,
            startTab: 'tab-1'
        }).addTo(map);

        // // Bookmarks
        // var control = new L.Control.Bookmarks().addTo(map);
        // map.fire('bookmark:new', {
        //     latlng: new L.LatLng(..., ...)
        // });5

        // load geojson and add custom icons to points
        $.getJSON("points.geojson", function (data) {
            var metallocations = L.geoJson(data, {
                pointToLayer: function geojsonType(feature, latlng) {
                    switch (feature.properties["Type"]) {
                        case "festival":
                            var festivalIcon = new L.icon({
                                iconUrl: 'images/festival.png', //assign PNG
                                iconSize: [52, 52], // size of the icon
                            });
                            return L.marker(latlng, { icon: festivalIcon }).bindTooltip(feature.properties.Name + "<br>" + feature.properties.Address);
                        
                        case "pub":
                            var pubIcon = new L.icon({
                                iconUrl: 'images/pub.png', //assign PNG
                                iconSize: [52, 52], // size of the icon 
                            });
                            return L.marker(latlng, { icon: pubIcon }).bindTooltip(feature.properties.Name + "<br>" + feature.properties.Address);

                        case "pubandrestaurant":
                            var pubandrestaurantIcon = new L.icon({
                                iconUrl: 'images/pubandrestaurant.png', //assign PNG
                                iconSize: [52, 52], // size of the icon
                            });
                            return L.marker(latlng, { icon: pubandrestaurantIcon }).bindTooltip(feature.properties.Name + "<br>" + feature.properties.Address);

                            case "pubandvenue":
                            var pubandvenueIcon = new L.icon({
                                iconUrl: 'images/pubandvenue.png', //assign PNG
                                iconSize: [52, 52], // size of the icon
                            });
                            return L.marker(latlng, { icon: pubandvenueIcon }).bindTooltip(feature.properties.Name + "<br>" + feature.properties.Address);

                            case "restaurant":
                            var restaurantIcon = new L.icon({
                                iconUrl: 'images/restaurant.png', //assign PNG
                                iconSize: [52, 52], // size of the icon
                            });
                            return L.marker(latlng, { icon: restaurantIcon }).bindTooltip(feature.properties.Name + "<br>" + feature.properties.Address);

                        case "recordstore":
                            var recordstoreIcon = new L.icon({
                                iconUrl: 'images/recordstore.png', //assign PNG
                                iconSize: [52, 52], // size of the icon
                            });
                            return L.marker(latlng, { icon: recordstoreIcon }).bindTooltip(feature.properties.Name + "<br>" + feature.properties.Address);

                        case "venue":
                            var venueIcon = new L.icon({
                                iconUrl: 'images/venue.png', //assign PNG
                                iconSize: [52, 52], // size of the icon
                            });
                            return L.marker(latlng, { icon: venueIcon }).bindTooltip(feature.properties.Name + "<br>" + feature.properties.Address);
                    }
                },

                onEachFeature: function (feature, layer) {
                    layer.on('click', function (e) {
                        // get coordinates from GeoJSON
                        var coords = feature.geometry.coordinates
                        //pass coords to function to create marker.(Yellow circle)
                        onMapClick(coords);

                        //place attributes in panel table.
                        var fieldA = document.getElementById('popuptitle');
                        fieldA.innerHTML = "<a href='" + feature.properties.Website + "'>" + feature.properties.Name + "</a>";

                        var field1 = document.getElementById('f1');
                        field1.innerHTML = feature.properties.Address;
                        var field3 = document.getElementById('f3');
                        field3.innerHTML = e.target.feature.properties.Descriptio;
                    });
                }
            });
            map.fitBounds(metallocations.getBounds());
            var clusters = L.markerClusterGroup({
                spiderfyOnMaxZoom: true,
                showCoverageOnHover: false,
                zoomToBoundsOnClick: true
            });
            clusters.addLayer(metallocations);
            map.addLayer(clusters);
            // add search
            map.addControl(new L.Control.Search({
                layer: clusters,
                textPlaceholder: 'Search by city...',
                propertyName: 'City',
                position: "bottomleft",
                autoCollapse: true,
                marker: false,
                textErr: "No results found...",
                moveToLocation: function (latlng) {
                    map.setView(latlng, 10);
                }
            })
            );
            // end getJSON
        },
        );

        // click marker
        var clickmark;
        // When you click on a circle, it calls the onMapClick function and passes the layers coordinates.
        // grab the coords which are X,Y, and flip them to latLng for a marker,  
        function onMapClick(coords) {
            console.log(coords);
            var thecoords = coords.toString().split(',');
            var lat = thecoords[1];
            var lng = thecoords[0];
            //if prior marker exists, remove it.
            if (clickmark != undefined) {
                map.removeLayer(clickmark);
            };
            clickmark = L.circleMarker([lat, lng], {
                radius: 12,
                color: "red",
                fillColor: "red",
                fillOpacity: 1
            }
            ).addTo(map);
        }
        // end of code for click marker.

        //Leaflet.Search.Control by country
        var CountryStyle = {
            "color": "none",
            "strokeWeight": 0,
            "fillOpacity": 1,
        };
        var countries_geojson = new L.GeoJSON.AJAX("countries.geojson", { style: CountryStyle });
        countries_geojson.on('data:loaded', function () {
            countries_geojson.addTo(map);
        });
        var CountrysearchControl = new L.Control.Search({
            layer: countries_geojson,
            propertyName: 'ADMIN',
            marker: false,
            position: "topleft",
            textPlaceholder: 'Search by country...',
            autoCollapse: true,
            // autoCollapseTime: 1200,
            textErr: 'No results found...',
            moveToLocation: function (latlng) {
                map.setView(latlng, 6); // access zoom level
            }
        }
        );
        map.addControl(CountrysearchControl);  //inizialize search control

        // OSM search
        var geocoder = L.Control.geocoder({
            defaultMarkGeocode: true,
        }).addTo(map);
    </script>
</body>

</html>